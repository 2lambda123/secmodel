from secmodel_schedule import securitisefrom flask import Flask, render_template, request, jsonifyimport pandas as pdfrom datetime import dateimport numpy as np import warningsapp = Flask(__name__)def render_search_response(gen_json:bool=False) -> str:    """Return either a JSON- or HTML-formatted search response."""    principal = request.form['principal']    default_amt = request.form['default_amt']    addl_principal = request.form['addl_principal']    interest_rate = request.form['interest_rate']    sen_interest_rate = request.form['sen_interest_rate']    sub_interest_rate = request.form['sub_interest_rate']    years=float(30)    annual_payments=float(12)        # results = securitise(principal, default_amt, addl_principal, interest_rate, sen_interest_rate, sub_interest_rate)    schedule = pd.DataFrame(securitise(principal, default_amt, interest_rate, years, sen_interest_rate, sub_interest_rate, addl_principal, start_date=date(2020, 7,1)))    warnings.filterwarnings('ignore', category=DeprecationWarning)    asset_endbalance = round(schedule.iloc[359, 15], 0)    senior_endbalance = round(schedule.iloc[359, 29], 0)    subordinated_endbalance = round(schedule.iloc[359, 44], 0)    reserve_balance_due = round((schedule.iloc[0, 31]) - (schedule.iloc[359, 34]), 0)        #asset irr    asset_return_list = schedule.iloc[:, 46].to_list()    asset_return_list.insert(0, -schedule.iloc[0,9])    irr_asset = round(((1+np.irr(asset_return_list))**12)-1, 4)        #senior irr    senior_return_list = schedule.iloc[:, 47].to_list()    senior_return_list.insert(0, -schedule.iloc[0,19])    irr_senior = round(((1+np.irr(senior_return_list))**12)-1, 4)    #subordinated irr    sub_return_list = schedule.iloc[:, 48].to_list()    sub_return_list.insert(0, -schedule.iloc[0,36])    irr_subordinated = round(((1+np.irr(sub_return_list))**12)-1, 4)        #create csv file    schedule_csv = schedule.to_csv('secmodel.csv', index=False)    if gen_json:        return jsonify(the_principal=principal,                       the_default_amt=default_amt,                       the_interest_rate = interest_rate,                       the_sen_interest_rate = sen_interest_rate,                       the_sub_interest_rate = sen_interest_rate,                       the_years=years,                       the_annual_payments = annual_payments,                       # the_asset_endbalance=asset_endbalance,                       # the_irr_asset = irr_asset,                       # the_senior_endbalance= senior_endbalance,                       # the_irr_senior = irr_senior,                       # the_subordinated_endbalance = subordinated_endbalance,                       the_results = schedule,                       the_asset_endbalance=asset_endbalance,                       the_senior_endbalance=senior_endbalance,                       the_subordinated_endbalance = subordinated_endbalance,                       the_reserve_balance_due = reserve_balance_due,                       the_irr_asset = irr_asset,                       the_irr_senior = irr_senior,                       the_irr_subordinated = irr_subordinated,                       the_schedule_csv = schedule_csv)    return render_template('results.html',                           the_title='Results from Securitisation Model',                           the_principal=principal,                           the_default_amt=default_amt,                           the_interest_rate = interest_rate,                           the_sen_interest_rate = sen_interest_rate,                           the_sub_interest_rate = sub_interest_rate,                           the_years=years,                           the_annual_payments = annual_payments,                           # the_asset_endbalance=asset_endbalance,                           # the_irr_asset = irr_asset,                           # the_senior_endbalance= senior_endbalance,                           # the_irr_senior = irr_senior,                           # the_subordinated_endbalance = subordinated_endbalance,                           the_results = schedule,                           the_asset_endbalance=asset_endbalance,                           the_senior_endbalance=senior_endbalance,                           the_subordinated_endbalance = subordinated_endbalance,                           the_reserve_balance_due = reserve_balance_due,                           the_irr_asset = irr_asset,                           the_irr_senior = irr_senior,                           the_irr_subordinated = irr_subordinated,                           the_schedule_csv = schedule_csv)@app.route('/')@app.route('/home')def home_page():    """Returns the entry page to browser."""    return render_template('home.html',                           the_title='Welcome to the Securitisation Model',                           the_url='/entry')@app.route('/entry')def entry_page():    """Returns the entry page to browser."""    return render_template('input.html',                           the_title='Securitisation Model',                           the_url='/model')@app.route('/model', methods=['POST'])def model():    """Returns the results of a call to 'securities to the browser."""    return render_search_response()@app.route('/homejson')def home_json_page():    """Returns the JSON home page to browser."""    return render_template('home.html',                           the_title='Welcome to the Securitisation Model',                           the_url='/entryjson')@app.route('/entryjson')def entry_json_page():    """Returns the JSON entry page to browser."""    return render_template('input.html',                           the_title='Securitisation Model',                           the_url='/modeljson')@app.route('/modeljson', methods=['POST'])def modeljson():    """Returns the results of a call to 'securitise' to the browser."""    return render_search_response(True)if __name__ == '__main__':    app.run(debug=True)